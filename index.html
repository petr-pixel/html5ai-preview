<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>html5ai — clean preview</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f162e; --muted:#8aa0c7; --text:#e7ecf7;
    --card:#121b34; --accent:#6ee7b7; --accent2:#60a5fa; --border:#1e2a4a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:linear-gradient(180deg,#0b1020 0%, #0b1327 100%); color:var(--text); font:14px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  header{position:sticky;top:0;z-index:20;background:rgba(10,16,34,.7);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  header .bar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 24px;max-width:1200px;margin:0 auto}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:10px;background:#0ea5e9;display:grid;place-items:center;font-weight:800;color:#021024}
  .tag{color:var(--muted);font-size:12px}
  .btn{appearance:none;border:1px solid var(--border);background:#0f1831;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:linear-gradient(90deg,#34d399,#60a5fa);color:#061123;border:0}
  .btn.ghost{background:transparent}
  main{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:20px}
  @media (max-width:980px){ main{grid-template-columns:1fr} }
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
  .title{font-weight:800;margin:6px 0 10px 0}
  label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
  input[type="text"],input[type="url"],textarea,select{width:100%;background:#0c142c;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
  input[type="file"]{width:100%}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0d1730;color:var(--muted);font-size:12px}
  .previewGrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}
  @media (max-width:1100px){ .previewGrid{grid-template-columns:repeat(2,minmax(0,1fr))} }
  @media (max-width:720px){ .previewGrid{grid-template-columns:1fr} }
  iframe{border:1px solid var(--border);border-radius:12px;background:#fff}
  details{border:1px dashed var(--border);border-radius:12px;padding:10px;margin-top:12px}
  details summary{cursor:pointer;color:var(--muted);font-weight:700}
  .chat{height:220px;overflow:auto;background:#0c142c;border:1px solid var(--border);border-radius:12px;padding:10px}
  .chat .msg{margin:8px 0}
  .msg.user{color:#cbd5e1}
  .msg.ai{color:#a7f3d0}
  .badge{border-radius:10px;padding:8px 10px;font-size:13px;display:inline-block}
  .ok{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.5);color:#bbf7d0}
  .warn{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.5);color:#fde68a}
  .err{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.5);color:#fecaca}
  footer{color:#7e8fb5;text-align:center;margin:30px 0}
  .mini{font-size:12px;color:#93a2c8}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="brand"><div class="logo">AI</div><div><strong>html5ai</strong><div class="tag">AI banner builder • clean preview</div></div></div>
    <div class="row">
      <button class="btn ghost" id="newProject">Nový projekt</button>
      <button class="btn" id="importUrl">Extract z URL</button>
      <button class="btn primary" id="exportZipTop">Export HTML5</button>
    </div>
  </div>
</header>

<div class="wrap">
  <main>
    <!-- LEFT -->
    <section class="panel">
      <div class="title">Krok 1 — Vstup</div>
      <label>URL (pro clickTag / barvy / logo extrakci)</label>
      <input id="brandUrl" type="url" placeholder="https://www.tvujweb.cz">

      <div class="grid2">
        <div>
          <label>Headline</label>
          <input id="headline" type="text" value="Zimní výbava do hor">
        </div>
        <div>
          <label>Subline</label>
          <input id="subline" type="text" value="Teplo, styl a výkon v jednom.">
        </div>
      </div>
      <div class="grid2">
        <div>
          <label>CTA</label>
          <input id="cta" type="text" value="Prohlédnout">
        </div>
        <div>
          <label>Click URL</label>
          <input id="clickUrl" type="url" value="https://www.nordblanc-obchod.cz/">
        </div>
      </div>

      <div class="title" style="margin-top:18px">Krok 2 — Assets</div>
      <div class="grid2">
        <div>
          <label>Logo (URL / upload)</label>
          <input id="logoUrl" type="url" placeholder="https://...logo.png">
          <input id="logoFile" type="file" accept="image/*">
        </div>
        <div>
          <label>Pozadí / produkt (URL / upload)</label>
          <input id="bgUrl" type="url" placeholder="https://...image.jpg">
          <input id="bgFile" type="file" accept="image/*">
        </div>
      </div>
      <label>Barvy</label>
      <div class="grid3">
        <div><input id="bg" type="text" value="linear-gradient(180deg,#17324F,#0A1A2B)"></div>
        <div><input id="fg" type="text" value="#ffffff"></div>
        <div><input id="ctaBg" type="text" value="#E4572E"></div>
      </div>

      <details>
        <summary>Per-formát pozice (BG & Logo)</summary>
        <div id="perSize"></div>
      </details>

      <div class="title" style="margin-top:18px">Validator</div>
      <div id="badge" class="badge ok">OK — připraveno k exportu</div>
      <ul id="issues" class="mini" style="margin:8px 0 0 18px"></ul>

      <div class="title" style="margin-top:18px">AI Copy (demo)</div>
      <div class="chat" id="chat">
        <div class="msg ai">Ahoj! Chceš kratší headline, světlejší CTA nebo product-driven variantu?</div>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" data-copy="short">Krátký headline</button>
        <button class="btn" data-copy="warm">Sezónní (zima)</button>
        <button class="btn" data-copy="promo">Promo -50%</button>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="panel">
      <div class="row" style="justify-content:space-between">
        <div class="title">Live preview</div>
        <div class="pill">Formáty: 300×250 · 970×250 · 970×90 · 300×600 · 160×600</div>
      </div>
      <div id="preview" class="previewGrid"></div>
      <div class="row" style="justify-content:flex-end;margin-top:8px">
        <button class="btn primary" id="exportZip">Export HTML5</button>
      </div>
    </section>
  </main>

  <footer>© 2025 html5ai — clean-room preview (neklonuje žádný cizí web; vlastní UI & kód)</footer>
</div>

<script>
  // Clean-room: podobné flow, ale vlastní UI/implementace
  const SIZES = [
    {key:'300x250', w:300, h:250},
    {key:'970x250', w:970, h:250},
    {key:'970x90',  w:970, h:90 },
    {key:'300x600', w:300, h:600},
    {key:'160x600', w:160, h:600},
  ];
  const state = {}; SIZES.forEach(s=> state[s.key] = { bgX:0,bgY:0,bgScale:1, logoX:0,logoY:0,logoScale:1 });
  function byId(id){ return document.getElementById(id) }

  // file uploads → dataURL
  function hookFile(id, targetInput){
    byId(id).addEventListener('change', e=>{
      const f=e.target.files?.[0]; if(!f) return;
      const r=new FileReader(); r.onload=()=>{ byId(targetInput).value=r.result; render(); validate(); }; r.readAsDataURL(f);
    });
  }
  hookFile('logoFile','logoUrl'); hookFile('bgFile','bgUrl');

  function bannerHTML(w,h){
    const headline = byId('headline').value;
    const subline = byId('subline').value;
    const cta     = byId('cta').value;
    const click   = byId('clickUrl').value;
    const bg      = byId('bg').value;
    const fg      = byId('fg').value;
    const ctaBg   = byId('ctaBg').value;
    const logoUrl = byId('logoUrl').value;
    const bgUrl   = byId('bgUrl').value;
    const tr = state[`${w}x${h}`];
    const fH = Math.max(14, Math.round(w/12));
    const fS = Math.max(10, Math.round(w/20));
    const fC = Math.max(10, Math.round(w/22));
    const logoImg = logoUrl ? `<img src="${logoUrl}" alt="logo" style="position:absolute; left:10px; top:10px; transform: translate(${tr.logoX}px, ${tr.logoY}px) scale(${tr.logoScale}); height:${Math.round(h*0.12)}px; width:auto; opacity:.95; z-index:3;"/>` : "";
    const bgImg   = bgUrl ? `<img src="${bgUrl}" alt="bg" style="position:absolute; left:50%; top:50%; transform: translate(calc(-50% + ${tr.bgX}px), calc(-50% + ${tr.bgY}px)) scale(${tr.bgScale}); transform-origin:center center; height:110%; min-width:110%; opacity:.95; z-index:0;"/>` : "";
    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
<meta name="ad.size" content="width=${w},height=${h}"><title>banner</title>
<style>
:root{ --w:${w}px; --h:${h}px; --bg:${bg}; --fg:${fg}; --cta:${ctaBg}; }
*{box-sizing:border-box} html,body{margin:0;width:var(--w);height:var(--h);overflow:hidden}
.banner{position:relative;width:var(--w);height:var(--h);background:var(--bg);color:var(--fg);font-family:Arial,Helvetica,sans-serif;overflow:hidden}
.headline{position:absolute;left:50%;top:45%;transform:translate(-50%,-50%);width:calc(var(--w) - 40px);text-align:center;font-weight:800;line-height:1.1;font-size:${fH}px;opacity:0;animation:fade .6s ease-out .1s forwards;z-index:2}
.subline{position:absolute;left:50%;top:65%;transform:translate(-50%,-50%);width:calc(var(--w) - 50px);text-align:center;font-weight:500;line-height:1.2;font-size:${fS}px;opacity:0;animation:rise .6s ease-out .4s forwards;z-index:2}
.cta{position:absolute;left:50%;bottom:${Math.max(8,Math.round(h*0.05))}px;transform:translateX(-50%);padding:${Math.max(4,Math.round(h*0.04))}px ${Math.max(8,Math.round(w*0.04))}px;border-radius:999px;background:var(--cta);color:#061123;font-weight:800;font-size:${fC}px;letter-spacing:.2px;box-shadow:0 6px 14px rgba(0,0,0,.22);opacity:0;animation:pop .35s ease-out .8s forwards;z-index:2}
.bgimg{pointer-events:none}
@keyframes fade{from{opacity:0;transform:translate(-50%,-56%)}to{opacity:1;transform:translate(-50%,-50%)}}
@keyframes rise{from{opacity:0;transform:translate(-50%,-36%)}to{opacity:1;transform:translate(-50%,-50%)}}
@keyframes pop{from{transform:translateX(-50%) scale(.92);opacity:0}to{transform:translateX(-50%) scale(1);opacity:1}}
</style>
<script>window.clickTag=${JSON.stringify(click)};</script></head>
<body><a href="javascript:window.open(window.clickTag)" style="text-decoration:none">
<div class="banner">${bgImg}
<div class="headline">${headline}</div>
<div class="subline">${subline}</div>
<div class="cta">${cta}</div>
${logoImg}
</div></a></body></html>`;
  }

  function render(){
    const grid = document.getElementById('preview'); grid.innerHTML='';
    SIZES.forEach(s=>{
      const card = document.createElement('div');
      card.className='card';
      card.innerHTML = `<div class="mini" style="margin-bottom:6px">${s.key.replace('x','×')}</div>`;
      const ifr = document.createElement('iframe'); ifr.width = s.w; ifr.height = s.h; ifr.srcdoc = bannerHTML(s.w,s.h);
      card.appendChild(ifr);
      grid.appendChild(card);
    });
  }

  function validate(){
    const assets = [];
    ['logoUrl','bgUrl'].forEach(id=>{ const v=byId(id).value; if(v) assets.push(v) });
    let http=0, bytes=0;
    assets.forEach(a=>{
      if(String(a).startsWith('data:')){
        const b64=String(a).split(',')[1]||''; bytes+=Math.ceil(b64.length*3/4);
      }else http++;
    });
    bytes += 8000 * SIZES.length; // html estim
    const kb = Math.round(bytes/1024);
    const issues=[];
    if(http>100) issues.push({level:'error', msg:'Více než 100 HTTP požadavků.'});
    if(kb>5120) issues.push({level:'warn', msg:'Odhad ZIPu nad 5 MB — zvaž kompresi obrázků.'});
    const badge = byId('badge'); const list = byId('issues'); list.innerHTML='';
    if(issues.length===0){ badge.className='badge ok'; badge.textContent='OK — připraveno k exportu'; }
    else{ const hasErr=issues.some(i=>i.level==='error'); badge.className='badge '+(hasErr?'err':'warn'); badge.textContent=hasErr?'Problémy — zkontroluj níže':'Varování — zvážení před exportem'; issues.forEach(i=>{ const li=document.createElement('li'); li.textContent='['+i.level.toUpperCase()+'] '+i.msg; list.appendChild(li) }) }
  }

  // Per-size sliders
  function renderPerSize(){
    const wrap = byId('perSize'); wrap.innerHTML='';
    SIZES.forEach(s=>{
      const tr = state[s.key];
      const box = document.createElement('div'); box.className='card'; box.style.marginTop='10px';
      box.innerHTML = `<div class="mini" style="margin-bottom:6px">${s.key.replace('x','×')}</div>
      <div class="grid2">
        <div>
          <label>BG X</label><input type="range" min="-${Math.max(s.w,s.h)}" max="${Math.max(s.w,s.h)}" value="${tr.bgX}" data-k="${s.key}" data-t="bg" data-f="x">
          <label>BG Y</label><input type="range" min="-${Math.max(s.w,s.h)}" max="${Math.max(s.w,s.h)}" value="${tr.bgY}" data-k="${s.key}" data-t="bg" data-f="y">
          <label>BG Scale</label><input type="range" min="50" max="250" value="${Math.round(tr.bgScale*100)}" data-k="${s.key}" data-t="bg" data-f="s">
        </div>
        <div>
          <label>Logo X</label><input type="range" min="-${Math.max(s.w,s.h)}" max="${Math.max(s.w,s.h)}" value="${tr.logoX}" data-k="${s.key}" data-t="logo" data-f="x">
          <label>Logo Y</label><input type="range" min="-${Math.max(s.w,s.h)}" max="${Math.max(s.w,s.h)}" value="${tr.logoY}" data-k="${s.key}" data-t="logo" data-f="y">
          <label>Logo Scale</label><input type="range" min="50" max="250" value="${Math.round(tr.logoScale*100)}" data-k="${s.key}" data-t="logo" data-f="s">
        </div>
      </div>`;
      wrap.appendChild(box);
    });
    wrap.querySelectorAll('input[type=range]').forEach(r=>{
      r.addEventListener('input',e=>{
        const t=e.target; const k=t.getAttribute('data-k'); const type=t.getAttribute('data-t'); const f=t.getAttribute('data-f'); const v=parseInt(t.value,10);
        const tr=state[k];
        if(type==='bg'){ if(f==='x') tr.bgX=v; else if(f==='y') tr.bgY=v; else tr.bgScale=v/100; }
        else{ if(f==='x') tr.logoX=v; else if(f==='y') tr.logoY=v; else tr.logoScale=v/100; }
        render(); validate();
      });
    });
  }

  // Chat copy buttons
  document.querySelectorAll('[data-copy]').forEach(b=>{
    b.addEventListener('click',()=>{
      const type=b.getAttribute('data-copy');
      const chat=byId('chat'); const add=(cls,txt)=>{ const d=document.createElement('div'); d.className='msg '+cls; d.textContent=txt; chat.appendChild(d); chat.scrollTop=chat.scrollHeight; }
      add('user','Chci variantu: '+type);
      let v={h:'',s:'',c:''};
      if(type==='short') v={h:'Zimní výbava', s:'Lehké a teplé', c:'Prohlédnout'};
      if(type==='warm') v={h:'Teplo do mrazu', s:'Funkční vrstvy 24/7', c:'Zjistit více'};
      if(type==='promo') v={h:'Sleva až 50 %', s:'Jen tento týden', c:'Nakoupit teď'};
      add('ai', `Headline: ${v.h} • Subline: ${v.s} • CTA: ${v.c}`);
      byId('headline').value=v.h; byId('subline').value=v.s; byId('cta').value=v.c;
      render(); validate();
    });
  });

  // Actions
  document.getElementById('exportZip').addEventListener('click', exportZip);
  document.getElementById('exportZipTop').addEventListener('click', exportZip);
  document.getElementById('importUrl').addEventListener('click', ()=>{
    const u=byId('brandUrl').value||'';
    // lightweight seeding – čistě demo: barvy podle domény
    const dark = "linear-gradient(180deg,#13233c,#0a1629)";
    const orange = "#E4572E";
    const white = "#ffffff";
    if(u.includes('nordblanc')){ byId('bg').value=dark; byId('ctaBg').value=orange; byId('fg').value=white; }
    render(); validate();
  });

  function exportZip(){
    const script = document.createElement('script');
    script.src = "https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js";
    script.onload = async () => {
      const zip = new JSZip();
      SIZES.forEach(s => {
        const html = bannerHTML(s.w,s.h);
        zip.folder(s.key).file("index.html", html);
      });
      const blob = await zip.generateAsync({ type: "blob" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "html5ai-clean-preview.zip";
      a.click();
    };
    document.body.appendChild(script);
  }

  // init
  render(); renderPerSize(); validate();
</script>
</body>
</html>
